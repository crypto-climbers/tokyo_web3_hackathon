import { useRef, useState, useEffect } from "react";
import { ForceGraph2D } from "react-force-graph";
//@ts-ignore
import { forceCollide } from "d3-force-3d";
import { useDisclosure } from "@chakra-ui/react";
import Modal from "@/components/GenericSidebar";
import { NodeType, Protocol } from "@/types";
import UniswapSidebar from "./UniswapSidebar";
import CowSwapSideBar from "./CowSwapSideBar";

interface Props {
  size: number;
  data: NodeType[];
  highlightColor: string;
}

const CollisionDetectionFG = ({ size, data, highlightColor }: Props) => {
  const fgRef = useRef();
  const [graphData, setGraphData] = useState({ nodes: [], links: [] });
  const { isOpen, onOpen, onClose } = useDisclosure();
  const [selectedNode, setSelectedNode] = useState<NodeType | undefined>(
    undefined
  );
  const [originalColor, setOriginalColor] = useState("");

  const handleClick = (node) => {
    setOriginalColor(node.color);
    setSelectedNode(node);

    node.color = highlightColor;

    onOpen();

    fgRef.current.centerAt(
      node.x,
      node.y,
      500 // ms transition duration
    );
    fgRef.current.zoom(8, 500);
  };

  const handleClose = (node) => {
    onClose();

    node.color = originalColor;
    setSelectedNode({});
    fgRef.current.zoomToFit(1000, 300);
  };

  useEffect(() => {
    const fg = fgRef.current;

    if (fg) {
      // Deactivate existing forces
      fg.d3Force("center", null);
      fg.d3Force("charge", null);

      // Add collision and bounding box forces
      fg.d3Force(
        "collide",
        forceCollide((d) => d.val)
      );
      fg.d3Force("box", () => {
        const SQUARE_HALF_SIDE = size * 2;

        data.forEach((node) => {
          const x = node.x || 0,
            y = node.y || 0;

          // bounce on box walls
          if (Math.abs(x) > SQUARE_HALF_SIDE) {
            node.vx *= -1;
          }
          if (Math.abs(y) > SQUARE_HALF_SIDE) {
            node.vy *= -1;
          }
        });
      });
    }

    setGraphData({ nodes: data, links: [] });
  }, [data, size]);

  return (
    <>
      <ForceGraph2D
        ref={fgRef}
        graphData={graphData}
        cooldownTime={Infinity}
        d3AlphaDecay={0}
        d3VelocityDecay={0.035}
        onNodeClick={handleClick}
        nodeColor={(d) => d.color}
        nodeLabel={(node) =>
          `
          <div style="display: flex; height:20px">
            <img width="20px" height="20px"  src=${node.img && node.img[0]}
            }/>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="body_1" width="17" height="20">
                <g transform="matrix(0.0949208 0 0 0.0949208 0.15608284 -0)">
                <path d="M171.431 85.415C 170.025 79.505005 164.096 75.846 158.184 77.259C 152.274 78.664 148.62201 84.595 150.02701 90.505005C 155.205 112.276 148.86201 134.70801 133.061 150.509C 114.272 169.298 86.59401 173.90001 63.440002 164.332L63.440002 164.332L72.915 162.62401C 78.894 161.54701 82.867004 155.826 81.79 149.848C 80.712 143.869 74.994 139.897 69.013 140.97401L69.013 140.97401L33.017002 147.46202C 32.997 147.46503 32.979004 147.47202 32.960003 147.47603C 32.202003 147.61603 31.457003 147.83603 30.736004 148.13702C 30.671003 148.16402 30.609003 148.19803 30.545004 148.22603C 30.261003 148.35103 29.981005 148.48402 29.706003 148.63403C 29.605003 148.68903 29.509003 148.75104 29.410004 148.80904C 29.183004 148.94203 28.959003 149.08003 28.740004 149.23004C 28.620003 149.31303 28.505003 149.40105 28.388004 149.48904C 28.203005 149.62805 28.020004 149.76904 27.842005 149.92105C 27.713005 150.03105 27.589005 150.14606 27.465004 150.26205C 27.375004 150.34605 27.279003 150.42105 27.191004 150.50905C 27.124004 150.57605 27.068005 150.64905 27.003004 150.71704C 26.885004 150.84103 26.772003 150.96704 26.660004 151.09705C 26.509005 151.27104 26.365004 151.44804 26.227003 151.62904C 26.136003 151.74805 26.047003 151.86705 25.961002 151.99004C 25.812002 152.20204 25.674002 152.41904 25.542002 152.64003C 25.500002 152.70903 25.451002 152.77203 25.411001 152.84203C 25.389002 152.88103 25.373001 152.92203 25.351002 152.96103C 25.212002 153.21204 25.087002 153.46902 24.969002 153.72803C 24.927002 153.81903 24.881002 153.90903 24.842001 154.00102C 24.715 154.30103 24.605001 154.60602 24.506 154.91502C 24.488 154.97203 24.464 155.02702 24.447 155.08403C 24.334 155.45703 24.239 155.83403 24.166 156.21404C 24.161001 156.23804 24.16 156.26303 24.156 156.28703C 24.093 156.63203 24.045 156.97803 24.015 157.32703C 24.004 157.45503 24.003 157.58502 23.997 157.71402C 23.984 157.96101 23.973999 158.20802 23.977 158.45502C 23.979 158.60202 23.99 158.74902 23.998 158.89702C 24.011 159.13002 24.028 159.36201 24.054998 159.59402C 24.071999 159.74002 24.095 159.88503 24.117998 160.03102C 24.155998 160.27002 24.201998 160.50803 24.255999 160.74503C 24.286 160.87703 24.317 161.00803 24.352 161.14003C 24.421 161.39803 24.501999 161.65202 24.59 161.90604C 24.616 161.98004 24.632 162.05603 24.66 162.13104L24.66 162.13104L39.345 201.54305C 40.994 205.97005 45.192 208.70505 49.654 208.70505C 50.929 208.70505 52.228 208.48105 53.493 208.01004C 59.185 205.88904 62.081 199.55504 59.96 193.86205L59.96 193.86205L56.791 185.35704C 66.775 189.22304 77.336 191.17705 87.903 191.17705C 109.891 191.17705 131.87799 182.80705 148.617 166.06905C 169.85901 144.82704 178.38701 114.67705 171.43001 85.419044L171.43001 85.419044L171.431 85.415z" stroke="none" fill="#FFFFFF" fill-rule="nonzero"/>
                <path d="M49.656 210.702C 44.255997 210.702 39.358997 207.301 37.473 202.23799L37.473 202.23799L22.787998 162.82599C 22.757998 162.74599 22.726997 162.65099 22.699999 162.555C 22.598 162.26 22.504 161.95999 22.421999 161.657C 22.38 161.5 22.344 161.345 22.308998 161.191C 22.244999 160.90999 22.189999 160.62799 22.143997 160.34299C 22.117998 160.17499 22.090998 160.00398 22.070997 159.831C 22.037996 159.55199 22.016996 159.27899 22.002996 159.00299C 21.988997 158.78499 21.980997 158.63199 21.978996 158.47899C 21.974997 158.19199 21.985996 157.90099 22.000996 157.609L22.000996 157.609L22.004995 157.502C 22.008995 157.382 22.013996 157.262 22.024996 157.143C 22.059996 156.74 22.115995 156.33 22.190996 155.923C 22.197996 155.869 22.197996 155.866 22.208996 155.813C 22.285995 155.406 22.394997 154.97 22.533997 154.506C 22.545996 154.466 22.591997 154.334 22.605997 154.295C 22.719997 153.939 22.851997 153.578 23.001997 153.222C 23.038998 153.135 23.078997 153.049 23.119997 152.964C 23.290997 152.591 23.438997 152.28801 23.604998 151.99C 23.602997 151.985 23.638998 151.91501 23.678997 151.845C 23.720997 151.77 23.771997 151.692 23.824997 151.615C 23.984997 151.349 24.146997 151.09401 24.321997 150.845C 24.428997 150.69301 24.533997 150.553 24.639997 150.413C 24.799997 150.202 24.970997 149.991 25.151997 149.784C 25.276997 149.63899 25.412996 149.48799 25.551996 149.341C 25.640997 149.239 25.708996 149.16301 25.781996 149.09C 25.860996 149.011 25.948996 148.933 26.036995 148.856C 26.243996 148.666 26.390995 148.529 26.544994 148.399C 26.755995 148.21901 26.969994 148.052 27.186995 147.89C 27.378994 147.746 27.491995 147.662 27.607994 147.582C 27.863995 147.406 28.128994 147.243 28.395994 147.085C 28.564995 146.98201 28.653994 146.93001 28.744995 146.88C 29.074995 146.70001 29.406996 146.541 29.742994 146.39401C 29.828995 146.352 29.895994 146.32101 29.965994 146.292C 30.796993 145.94601 31.664993 145.686 32.548992 145.51901C 32.59299 145.50902 32.63999 145.49901 32.67499 145.49301L32.67499 145.49301L68.65999 139.00702C 75.70199 137.73602 82.48799 142.44102 83.75999 149.49402C 84.375984 152.91103 83.623985 156.36401 81.64399 159.21602C 79.66299 162.06802 76.68999 163.97801 73.27199 164.59302L73.27199 164.59302L71.33599 164.94202C 92.69899 170.89502 115.703995 165.03801 131.64899 149.09502C 146.956 133.78902 153.09898 112.05902 148.08398 90.96802C 147.27998 87.59002 147.84099 84.10102 149.66199 81.14402C 151.482 78.18702 154.346 76.11702 157.72398 75.31302C 161.09698 74.50702 164.58298 75.06402 167.53899 76.88202C 170.49998 78.70302 172.57399 81.57002 173.37799 84.95302C 180.49799 114.89102 171.77199 145.74301 150.034 167.48001C 133.465 184.04901 111.401 193.17401 87.906 193.17401C 78.440994 193.17401 69.131996 191.66801 60.173996 188.69301L60.173996 188.69301L61.837997 193.16C 64.340996 199.877 60.912 207.378 54.194996 209.88101C 52.732994 210.42601 51.205997 210.70201 49.656998 210.70201L49.656998 210.70201L49.656 210.702zM26.138998 156.551C 26.131998 156.59799 26.122997 156.651 26.116999 156.68599C 26.071999 156.93 26.033998 157.21399 26.008999 157.499L26.008999 157.499L25.994999 157.818C 25.984999 158.017 25.973999 158.219 25.977999 158.42099C 25.977999 158.51399 25.984999 158.60199 25.991 158.68999C 26.008 158.97798 26.019999 159.16798 26.043 159.35799C 26.057 159.47299 26.074999 159.59198 26.095 159.71098C 26.126 159.90898 26.163 160.10199 26.208 160.29398C 26.233 160.40398 26.258 160.51198 26.286 160.62097C 26.342999 160.83098 26.41 161.03998 26.481998 161.24797C 26.502998 161.30797 26.526 161.38297 26.546999 161.45798L26.546999 161.45798L41.221 200.84198C 42.528 204.34698 45.916 206.70198 49.656002 206.70198C 50.726 206.70198 51.784 206.51099 52.798 206.13298C 57.447 204.39998 59.821 199.20699 58.089 194.55698L58.089 194.55698L54.920002 186.05197C 54.645 185.31396 54.828003 184.48398 55.389004 183.92998C 55.951004 183.37598 56.782005 183.20398 57.517002 183.48798C 67.259 187.26097 77.484 189.17398 87.906006 189.17398C 110.33301 189.17398 131.392 180.46498 147.20601 164.65198C 167.953 143.90398 176.283 114.45598 169.48701 85.878975C 168.92902 83.53597 167.49402 81.55097 165.44301 80.29098C 163.397 79.031975 160.98401 78.64598 158.651 79.20598C 156.31 79.76298 154.328 81.19598 153.067 83.24298C 151.806 85.289986 151.419 87.70498 151.974 90.04398C 157.314 112.49698 150.773 135.62997 134.477 151.92499C 115.59601 170.80699 87.412 176.40298 62.67901 166.18298C 61.85901 165.84398 61.36001 165.00398 61.45401 164.12099C 61.54901 163.23799 62.21401 162.52298 63.08801 162.36598L63.08801 162.36598L72.56301 160.65799C 74.92901 160.232 76.987015 158.909 78.35901 156.93498C 79.73001 154.95998 80.25101 152.56998 79.824005 150.20398C 78.94401 145.32198 74.255005 142.06297 69.37 142.94398L69.37 142.94398L33.427002 149.42299C 33.385002 149.43298 33.341003 149.44199 33.308002 149.44798C 32.704002 149.55998 32.091003 149.74098 31.508003 149.98499C 31.486004 149.99498 31.373003 150.04898 31.352003 150.05899C 31.118004 150.16199 30.889004 150.26999 30.664003 150.39198L30.664003 150.39198L30.428003 150.53398C 30.241003 150.64398 30.057003 150.75497 29.878004 150.87898C 29.805004 150.92899 29.738005 150.97998 29.671003 151.03098C 29.669003 151.03198 29.587004 151.09297 29.585003 151.09398C 29.439003 151.20497 29.287003 151.32198 29.139004 151.44698C 29.036003 151.53497 28.936005 151.62898 28.834003 151.72397L28.834003 151.72397L28.666004 151.87497L27.144005 150.56396L28.593004 151.94397L28.460005 152.09097C 28.361004 152.19498 28.269005 152.29897 28.178005 152.40297C 28.049006 152.55197 27.933004 152.69498 27.822004 152.84097C 27.743004 152.94498 27.670004 153.04398 27.597004 153.14597C 27.481005 153.31297 27.368004 153.49196 27.258003 153.67296C 27.229004 153.72195 27.194004 153.77596 27.157003 153.82896C 27.140003 153.86296 27.124002 153.89496 27.106003 153.92697C 26.989002 154.13898 26.887003 154.34798 26.792004 154.55997L26.792004 154.55997L26.728004 154.69597C 26.583004 155.02696 26.495005 155.27597 26.414005 155.52696C 26.405005 155.55597 26.368006 155.65996 26.357006 155.68896C 26.276007 155.95796 26.200006 156.25397 26.141006 156.55397z" stroke="none" fill="#1A1A1A" fill-rule="nonzero"/>
                <path d="M149.848 58.714C 149.99701 58.501 150.13501 58.284 150.268 58.064C 150.309 57.995 150.358 57.932 150.39801 57.862C 150.42001 57.822998 150.436 57.781998 150.45801 57.743C 150.59702 57.491 150.723 57.235 150.841 56.975C 150.88301 56.884 150.92801 56.795 150.96701 56.703C 151.09401 56.403 151.20401 56.098 151.30301 55.788998C 151.32101 55.732 151.34502 55.677 151.36201 55.621C 151.47502 55.247997 151.57 54.871 151.64302 54.490997C 151.64803 54.467 151.64902 54.441998 151.65302 54.417995C 151.71602 54.072994 151.764 53.726997 151.79402 53.377995C 151.80502 53.249996 151.80602 53.119995 151.81203 52.990993C 151.82503 52.74399 151.83502 52.496994 151.83203 52.249992C 151.83003 52.102993 151.81903 51.955994 151.81104 51.80799C 151.79803 51.57499 151.78104 51.34299 151.75403 51.110992C 151.73703 50.964993 151.71404 50.819992 151.69102 50.673992C 151.65303 50.434994 151.60703 50.19699 151.55302 49.95999C 151.52303 49.82799 151.49202 49.69699 151.45703 49.56499C 151.38803 49.30699 151.30704 49.05199 151.21803 48.797993C 151.19203 48.72399 151.17603 48.64799 151.14803 48.573994L151.14803 48.573994L136.46303 9.161995C 134.34203 3.470995 128.00703 0.57099533 122.315025 2.694995C 116.623024 4.815995 113.72703 11.149995 115.84802 16.842995L115.84802 16.842995L119.01702 25.347996C 88.25702 13.437996 51.97502 19.853996 27.191025 44.635994C 5.9070244 65.923 -2.6089745 96.12499 4.413025 125.42999C 5.622025 130.476 10.130025 133.86899 15.101025 133.86899C 15.950025 133.86899 16.812025 133.76898 17.673025 133.56299C 23.581024 132.14699 27.223026 126.20999 25.807026 120.30199C 20.582026 98.49599 26.915026 76.025986 42.748024 60.193985C 61.537025 41.402985 89.21602 36.800987 112.370026 46.369984L112.370026 46.369984L102.89303 48.077984C 96.91403 49.154984 92.941025 54.875984 94.01803 60.853985C 94.97703 66.17298 99.61003 69.90498 104.831024 69.90498C 105.47803 69.90498 106.135025 69.846985 106.79502 69.72798L106.79502 69.72798L142.79102 63.239983C 142.81102 63.236984 142.82901 63.229984 142.84901 63.225983C 143.60701 63.085983 144.35301 62.864983 145.07402 62.564983C 145.13602 62.538982 145.19502 62.506985 145.25702 62.479984C 145.54402 62.354984 145.82703 62.218983 146.10402 62.067986C 146.20302 62.013985 146.29802 61.952984 146.39603 61.895985C 146.62402 61.761986 146.85002 61.623985 147.07002 61.471985C 147.18903 61.389984 147.30402 61.301987 147.42003 61.214985C 147.60603 61.075985 147.79002 60.932983 147.96803 60.779984C 148.09604 60.670982 148.22003 60.555984 148.34303 60.440983C 148.43404 60.356983 148.53003 60.280983 148.61803 60.191982C 148.68503 60.12498 148.74202 60.050983 148.80702 59.982983C 148.92403 59.85998 149.03702 59.733982 149.14803 59.605984C 149.29903 59.430984 149.44403 59.252983 149.58203 59.071983C 149.67203 58.952984 149.76103 58.834984 149.84703 58.711983L149.84703 58.711983L149.848 58.714z" stroke="none" fill="#FFFFFF" fill-rule="nonzero"/>
                <path d="M15.101 135.869C 9.07 135.869 3.8739996 131.768 2.467 125.895004C -4.718 95.909004 3.996 65.004005 25.778 43.223007C 49.327 19.674007 84.171005 11.577007 115.639 22.012007L115.639 22.012007L113.974 17.543007C 111.471 10.826007 114.9 3.3250065 121.617 0.8220062C 124.870995 -0.39199376 128.402 -0.26399374 131.561 1.1800063C 134.71901 2.6240063 137.125 5.211006 138.337 8.465006L138.337 8.465006L153.022 47.877007C 153.056 47.968006 153.084 48.058006 153.10901 48.148006C 153.21101 48.440006 153.30602 48.741005 153.38802 49.046005C 153.43002 49.203007 153.46602 49.358006 153.50102 49.512005C 153.56502 49.793003 153.62003 50.075005 153.66602 50.360004C 153.69301 50.532005 153.72002 50.708004 153.74002 50.885006C 153.77103 51.145004 153.79202 51.422005 153.80702 51.700005C 153.82103 51.918003 153.82903 52.071003 153.83102 52.224003C 153.83502 52.511 153.82402 52.802002 153.80902 53.094L153.80902 53.094L153.80502 53.201C 153.80103 53.321 153.79602 53.441 153.78502 53.56C 153.75002 53.963 153.69402 54.373 153.61902 54.780003C 153.61201 54.834003 153.61201 54.837 153.60101 54.890003C 153.52002 55.307003 153.40901 55.756004 153.27301 56.202003C 153.257 56.258003 153.231 56.333004 153.20401 56.408005C 153.09001 56.763004 152.95901 57.125004 152.80801 57.481003C 152.77101 57.570004 152.73001 57.657 152.68802 57.744003C 152.52002 58.111004 152.37202 58.413002 152.20602 58.712C 152.20602 58.718002 152.17102 58.789 152.13103 58.858C 152.08902 58.933002 152.03802 59.011 151.98503 59.088C 151.82503 59.353 151.66203 59.607002 151.48804 59.857002L151.48804 59.857002L151.48503 59.861004C 151.38403 60.004005 151.28203 60.142002 151.17703 60.280003C 151.00803 60.500004 150.83803 60.710003 150.65903 60.916004C 150.52803 61.067005 150.39603 61.214005 150.26103 61.357006C 150.16603 61.465008 150.10204 61.537006 150.03203 61.607006C 149.94904 61.690006 149.85803 61.772007 149.76602 61.852005C 149.56203 62.039005 149.41502 62.175007 149.26102 62.306004C 149.05602 62.482002 148.83902 62.651005 148.61902 62.816C 148.43501 62.954002 148.32101 63.039 148.20302 63.120003C 147.94302 63.299004 147.67802 63.463 147.40901 63.620003L147.40901 63.620003L147.32101 63.672C 147.23701 63.723 147.15201 63.774002 147.06601 63.821C 146.73201 64.003 146.397 64.164 146.05602 64.312996C 145.97902 64.351 145.91501 64.38 145.85002 64.408C 145.01102 64.757996 144.14102 65.018 143.25702 65.184C 143.21402 65.194 143.16801 65.203995 143.13402 65.21L143.13402 65.21L107.14902 71.696C 106.38302 71.834 105.60302 71.904 104.83102 71.904C 98.542015 71.904 93.167015 67.406 92.04902 61.208C 91.43402 57.791 92.18602 54.338 94.166016 51.486C 96.14702 48.634 99.12002 46.724 102.53802 46.109L102.53802 46.109L104.47602 45.759003C 83.107025 39.803 60.10402 45.661003 44.161022 61.606003C 28.824022 76.942 22.689022 98.71001 27.751022 119.83501C 29.421022 126.80501 25.109022 133.835 18.138023 135.50601C 17.137024 135.74602 16.116024 135.867 15.100023 135.867L15.100023 135.867L15.101 135.869zM87.918 21.535004C 66.05 21.535004 44.600998 30.059004 28.605999 46.052002C 7.8169994 66.841 -0.5000019 96.341 6.358 124.964005C 7.332 129.029 10.927 131.869 15.101 131.869C 15.8029995 131.869 16.512 131.785 17.207 131.618C 22.033 130.46199 25.019001 125.59499 23.861 120.769C 18.473 98.281 25.005001 75.106995 41.334 58.78C 60.215 39.895996 88.4 34.3 113.134 44.522C 113.954 44.861 114.453 45.7 114.359 46.583C 114.264 47.466 113.599 48.181 112.725 48.338L112.725 48.338L103.248 50.046C 100.882 50.472 98.824005 51.795002 97.452 53.769C 96.081 55.744 95.560005 58.134003 95.98701 60.5C 96.76001 64.791 100.48001 67.905 104.83201 67.905C 105.366005 67.905 105.907005 67.855995 106.44001 67.76L106.44001 67.76L142.38701 61.281002C 142.43301 61.27 142.483 61.260002 142.52 61.254C 143.108 61.145 143.71901 60.963 144.304 60.719C 144.327 60.708 144.432 60.658 144.456 60.647003C 144.68799 60.545002 144.92 60.436005 145.14499 60.313004L145.14499 60.313004L145.385 60.170002C 145.568 60.062 145.75299 59.949 145.935 59.825C 146.006 59.776 146.076 59.723 146.145 59.671C 146.37001 59.502003 146.52 59.386 146.666 59.261C 146.775 59.168003 146.875 59.075 146.974 58.982002L146.974 58.982002L147.143 58.832C 147.261 58.71 147.31001 58.656002 147.36101 58.602C 147.449 58.509003 147.544 58.404 147.636 58.297C 147.759 58.154 147.878 58.008 147.991 57.859C 148.06 57.767002 148.134 57.670002 148.205 57.568C 148.328 57.392002 148.442 57.213 148.552 57.030003C 148.58101 56.981003 148.616 56.927002 148.653 56.873C 148.67 56.84 148.686 56.808002 148.704 56.776C 148.81999 56.565002 148.922 56.356003 149.01799 56.144L149.01799 56.144L149.081 56.008C 149.226 55.676 149.31499 55.427 149.39499 55.176C 149.40399 55.149 149.439 55.05 149.44899 55.023C 149.53499 54.742 149.60999 54.446 149.66899 54.148C 149.676 54.100998 149.685 54.049 149.691 54.015C 149.736 53.771 149.77399 53.487 149.799 53.202L149.799 53.202L149.813 52.883C 149.823 52.684 149.834 52.482 149.83 52.28C 149.83 52.187 149.823 52.099 149.817 52.010998C 149.801 51.725998 149.789 51.538 149.765 51.350998C 149.75 51.219997 149.732 51.105 149.713 50.989998C 149.68199 50.791996 149.645 50.599 149.59999 50.406998C 149.575 50.296997 149.54999 50.189 149.52199 50.079998C 149.46498 49.871998 149.39899 49.663998 149.32698 49.456997C 149.29999 49.378 149.27998 49.311996 149.26198 49.246998L149.26198 49.246998L134.58698 9.858997C 133.74797 7.6069975 132.08098 5.814997 129.89497 4.815997C 127.70697 3.8149972 125.26097 3.7289972 123.01197 4.567997C 118.36197 6.300997 115.98797 11.493998 117.71997 16.143997L117.71997 16.143997L120.88897 24.648998C 121.16397 25.387 120.98097 26.217 120.41997 26.770998C 119.85797 27.323997 119.02497 27.495998 118.29297 27.212997C 108.42097 23.389997 98.119965 21.531998 87.91497 21.531998z" stroke="none" fill="#1A1A1A" fill-rule="nonzero"/>
            </g>
            </svg>
            <img width="20px" height="20px"  src=${node.img && node.img[1]}/>
          </div>
          `
        }
        nodeCanvasObjectMode={() => "after"}
        nodeCanvasObject={(node, ctx) => {
          const fontSize = 3;
          ctx.font = `${fontSize}px Sans-Serif`;
          ctx.textBaseline = "top";
          ctx.textAlign = "center";
          ctx.fillStyle = "white";
          ctx.fillText(
            `${node.token0 || node.token1} & ${
              node.token0 ? node.token1 : node.token2
            }`,
            node.x,
            node.y
          );
        }}
      />
      {selectedNode && (
        <>
          {selectedNode.protocol == Protocol.UNISWAP && (
            <UniswapSidebar
              isOpen={isOpen}
              onClose={() => handleClose(selectedNode)}
              node={selectedNode}
              inputToken={
                selectedNode.token0Address ==
                "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"
                  ? "NATIVE"
                  : selectedNode.token0Address
              }
              outputToken={
                selectedNode.token1Address ==
                "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"
                  ? "NATIVE"
                  : selectedNode.token1Address
              }
            />
          )}
          {selectedNode.protocol == Protocol.AAVE ||
            Protocol.CURVE ||
            (Protocol.LIDO && (
              <Modal
                isOpen={isOpen}
                onClose={() => handleClose(selectedNode)}
                node={selectedNode}
                title={selectedNode.title}
                color={selectedNode.color}
              />
            ))}
          {selectedNode.protocol == Protocol.COWSWAP && (
            <CowSwapSideBar
              isOpen={isOpen}
              onClose={() => handleClose(selectedNode)}
              node={selectedNode}
            />
          )}
        </>
      )}
    </>
  );
};

export default CollisionDetectionFG;
